#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <fcntl.h>
#include <sys/ioctl.h>
#include <string.h>
#include "ioctl_cmd.h"

int main() {
    int fd;
    IOCTL_CMD   cmd;

    SET_KEY_MES kmesg_a = {
        .mac = {0x00, 0x0c, 0x29, 0x83, 0x1a, 0x20},
        .aes_key = {0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,
                                0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18}
    };

    SET_AID_MES amesg_a = {
        .sn = 1,
        .ip6 = {0x20, 0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
                    ,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02},
        .aid = {0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x0a}
    };

    SET_KEY_MES kmesg_b = {
        .mac = {0x00, 0x0c, 0x29, 0xc2, 0x86, 0x18},
        .aes_key = {0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,
                                0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18}
    };

    SET_AID_MES amesg_b = {
        .sn = 2,
        .ip6 = {0x20, 0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
                    ,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01},
        .aid = {0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x0b}
    };

    // 打开字符设备文件发送命令
    fd = open(CMD_DEV_PATH, O_RDONLY);
    if(fd <= 0) {
        printf("Open cmd device error\n");
        return -1;
    }

    cmd.type = IOCTL_SET_AES_KEY;
    cmd.buff = &kmesg_a;
    ioctl(fd, IOCTL_DEV_LABEL, &cmd);

    cmd.type = IOCTL_SET_AES_KEY;
    cmd.buff = &kmesg_b;
    ioctl(fd, IOCTL_DEV_LABEL, &cmd);

    cmd.type = IOCTL_SET_AID;
    cmd.buff = &amesg_a;
    ioctl(fd, IOCTL_DEV_LABEL, &cmd);

    cmd.type = IOCTL_SET_AID;
    cmd.buff = &amesg_b;
    ioctl(fd, IOCTL_DEV_LABEL, &cmd);

    printf("Terminal registers successfully\n");
    return 0;
}